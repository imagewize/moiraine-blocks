/**
 * Mega Menu Block Styles
 * Applied both on the front-end and in the editor.
 */

// Variables for reusability
$transition-speed: 0.1s;
$icon-size: 0.6em;
$border-radius: var(--wp--preset--spacing--20, 0.5rem);
$z-index-menu: 1000;
$z-index-close-button: 100;

// Mobile menu positioning mixin
@mixin mobile-menu-full-width {
    left: 1rem;
    right: 1rem;
    width: calc(100vw - 2rem);
    max-width: none;
    min-width: auto;
}

.wp-block-moiraine-mega-menu {
    list-style: none;
    position: relative;

    // Toggle button and its states
    &__toggle {
        background-color: initial;
        border: none;
        color: currentColor;
        cursor: pointer;
        font: inherit;
        padding: 0;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 0.25em;

        &-icon {
            align-self: center;
            display: inline-block;
            font-size: inherit;
            height: $icon-size;
            line-height: 0;
            padding: 0;
            width: $icon-size;

            svg {
                stroke: currentColor;
                display: inline-block;
                height: inherit;
                margin-top: 0.075em;
                width: inherit;
                transition: all $transition-speed linear;
                transform: rotate(-90deg);
            }
        }

        // Expanded state
        &[aria-expanded="true"] {
            .wp-block-moiraine-mega-menu__toggle-icon svg {
                transform: rotate(0deg);
            }

            & ~ .moiraine-mega-menu,
            & ~ .wp-block-moiraine-mega-menu__menu-container {
                opacity: 1;
                overflow: visible;
                visibility: visible;
                box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            }
        }
    }
}

// Menu container (shared styles for both classes)
.moiraine-mega-menu,
.wp-block-moiraine-mega-menu__menu-container {
    // Base positioning and appearance
    height: auto;
    left: -1px;
    opacity: 0;
    overflow: hidden;
    position: absolute;
    top: calc(100% + 0.5rem);
    transition: opacity $transition-speed linear;
    visibility: hidden;
    z-index: $z-index-menu;
    background: var(--wp--preset--color--base, #ffffff);
    border-radius: $border-radius;

    // Width variants
    &.menu-width-content {
        max-width: min(var(--wp--style--global--content-size, 1200px), 95vw);
        width: max-content;
        min-width: max(400px, 30vw);
    }

    &.menu-width-wide {
        max-width: min(var(--wp--style--global--wide-size, 1600px), 95vw);
        width: max-content;
        min-width: max(500px, 40vw);
    }

    &.menu-width-full {
        max-width: 95vw;
        width: 100%;
        left: 50%;
        transform: translateX(-50%);
    }

    &.menu-width-auto {
        width: max-content;
        max-width: min(90vw, 800px);
        min-width: 320px;
    }

    &.menu-width-flexible {
        width: max-content;
        max-width: 85vw;
        min-width: max(350px, 25vw);
    }

    // Close button
    .menu-container__close-button {
        align-items: center;
        backdrop-filter: blur(16px) saturate(180%);
        background-color: rgba(255, 255, 255, 0.8);
        border: none;
        border-radius: 999999px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        opacity: 0;
        padding: 4px;
        position: absolute;
        right: 12px;
        text-align: center;
        top: 12px;
        transition: opacity 0.2s ease;
        z-index: $z-index-close-button;

        &:focus,
        &:hover {
            opacity: 1;
        }

        &:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }
    }

    &:hover .menu-container__close-button {
        opacity: 1;
    }

    // Inner block styling
    .is-responsive {
        display: flex;
    }

    .wp-block-template-part {
        width: 100%;
        max-width: none;

        &[data-type="menu"] {
            width: 100%;
            flex: 1;
        }
    }

    .wp-block-group,
    .wp-block-columns {
        width: 100%;
        max-width: none;

        .wp-block-column {
            min-width: 0; // Allow columns to shrink if needed
        }
    }

    // Menu positioning - mobile-first responsiveness
    &.menu-justified-left {
        left: -1px;
        right: auto;

        @media (max-width: 768px) {
            @include mobile-menu-full-width;
        }
    }

    &.menu-justified-right {
        left: auto;
        right: -1px;

        @media (max-width: 768px) {
            @include mobile-menu-full-width;
        }
    }

    &.menu-justified-center {
        left: 50%;
        transform: translateX(-50%);
        right: auto;

        @media (max-width: 768px) {
            @include mobile-menu-full-width;
            transform: none;
        }
    }
}

// Mobile navigation container overrides
// Only apply on mobile/tablet screens (max-width: 782px matches WordPress admin bar breakpoint)
@media (max-width: 782px) {
    .wp-block-navigation__responsive-container,
    .wp-block-navigation__responsive-container-content {
        .moiraine-mega-menu,
        .wp-block-moiraine-mega-menu__menu-container {
            // Override all width settings when inside mobile navigation
            left: 0 !important;
            right: auto !important;
            transform: none !important;
            width: 100% !important;
            max-width: 100% !important;
            min-width: auto !important;
            position: absolute !important;

            // When menu is open (visible), use relative positioning
            &[style*="visibility: visible"],
            &[style*="opacity: 1"] {
                position: relative !important;
            }
        }
    }
}

// Screen reader only text for accessibility
.screen-reader-text {
    clip: rect(1px, 1px, 1px, 1px);
    position: absolute !important;
    height: 1px;
    width: 1px;
    overflow: hidden;
}
